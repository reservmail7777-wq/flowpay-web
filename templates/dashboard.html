{% extends "base.html" %}

{% block title %}Главная | FlowPay{% endblock %}

{% block content %}
    <section class="formula-box">
        <div class="formula-block">
            <span class="formula-label">Расчет финансового баланса</span>
            <div class="formula-container">
                <code class="formula-text">-(pay_in - commission_in) + (pay_out + commission_out) + withdrawal</code>
            </div>
        </div>
        
        <div class="formula-details">
            <div class="detail-item">
                <strong>pay_in</strong> — сумма, поступившая на ваши платежные реквизиты, конвертированная в USDT по курсу заказа.
            </div>
            <div class="detail-item">
                <strong>commission_in</strong> — комиссия, установленная для заказов pay_in.
            </div>
            <div class="detail-item">
                <strong>pay_out</strong> — сумма, отправленная вами на реквизиты продавцов, конвертированная в USDT по курсу заказа.
            </div>
            <div class="detail-item">
                <strong>commission_out</strong> — комиссия, установленная для заказов pay_out.
            </div>
            <div class="detail-item">
                <strong>withdrawal</strong> — общая сумма в USDT всех пополнений баланса платформы.
            </div>
        </div>

        <div class="formula-footer">
            При расчете прибыли не учитываются комиссии, которые могут быть удержаны банком за совершенные транзакции.
        </div>
    </section>

    <div class="content-grid">
        <div class="card">
            <h3>Текущий баланс</h3>
            <div class="main-value">{{ "%.2f"|format(user.balance_usdt) }} USDT</div>
            <div class="sub-stats">
                <p>Прибыль за сегодня: <strong>{{ "%.2f"|format(user.balance_uah or 0) }} UAH</strong></p>
                <p>PayIn: 0,00 UAH / PayOut: 0,00 UAH</p>
                <p>Прибыль за 30 дней: <strong>0,00 UAH</strong></p>
            </div>
        </div>

        <div class="card">
            <h3>Статистика прибыли за 30 дней</h3>
            <div style="height: 250px;">
                <canvas id="darkChart"></canvas>
            </div>
        </div>
    </div>

    <a href="https://t.me/n77nkaz" target="_blank" class="floating-tg">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Support">
    </a>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('darkChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1 дек', '10 дек', '20 дек', '30 дек'],
                datasets: [{
                    label: 'Прибыль',
                    data: [0, 0, 0, 0],
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.05)',
                    fill: true,
                    tension: 0.4,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                }
            }
        });
    </script>
{% endblock %}